<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AxonFlow Platform Test Suite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .test-pass { color: #10b981; }
        .test-fail { color: #ef4444; }
        .test-pending { color: #f59e0b; }
    </style>
</head>
<body class="bg-gray-900 text-white p-8">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-3xl font-bold mb-8">ğŸ§ª AxonFlow Platform Test Suite</h1>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Backend API Tests -->
            <div class="bg-gray-800 rounded-lg p-6">
                <h2 class="text-xl font-bold mb-4">ğŸ”§ Backend API Tests</h2>
                <div id="backend-tests" class="space-y-2"></div>
                <button onclick="runBackendTests()" class="mt-4 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                    Run Backend Tests
                </button>
            </div>

            <!-- Frontend Tests -->
            <div class="bg-gray-800 rounded-lg p-6">
                <h2 class="text-xl font-bold mb-4">ğŸ¨ Frontend Tests</h2>
                <div id="frontend-tests" class="space-y-2"></div>
                <button onclick="runFrontendTests()" class="mt-4 bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                    Run Frontend Tests
                </button>
            </div>

            <!-- AI Teacher Tests -->
            <div class="bg-gray-800 rounded-lg p-6">
                <h2 class="text-xl font-bold mb-4">ğŸ¤– AI Teacher Tests</h2>
                <div id="ai-tests" class="space-y-2"></div>
                <button onclick="runAITests()" class="mt-4 bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600">
                    Run AI Tests
                </button>
            </div>

            <!-- Authentication Tests -->
            <div class="bg-gray-800 rounded-lg p-6">
                <h2 class="text-xl font-bold mb-4">ğŸ” Authentication Tests</h2>
                <div id="auth-tests" class="space-y-2"></div>
                <button onclick="runAuthTests()" class="mt-4 bg-cyan-500 text-white px-4 py-2 rounded hover:bg-cyan-600">
                    Run Auth Tests
                </button>
            </div>

            <!-- Payment System Tests -->
            <div class="bg-gray-800 rounded-lg p-6">
                <h2 class="text-xl font-bold mb-4">ğŸ’³ Payment Tests</h2>
                <div id="payment-tests" class="space-y-2"></div>
                <button onclick="runPaymentTests()" class="mt-4 bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600">
                    Run Payment Tests
                </button>
            </div>

            <!-- Course System Tests -->
            <div class="bg-gray-800 rounded-lg p-6">
                <h2 class="text-xl font-bold mb-4">ğŸ“š Course Tests</h2>
                <div id="course-tests" class="space-y-2"></div>
                <button onclick="runCourseTests()" class="mt-4 bg-indigo-500 text-white px-4 py-2 rounded hover:bg-indigo-600">
                    Run Course Tests
                </button>
            </div>
        </div>

        <!-- Test Results Summary -->
        <div class="mt-8 bg-gray-800 rounded-lg p-6">
            <h2 class="text-xl font-bold mb-4">ğŸ“Š Test Summary</h2>
            <div id="test-summary" class="grid grid-cols-3 gap-4">
                <div class="text-center">
                    <div id="passed-count" class="text-2xl font-bold test-pass">0</div>
                    <div class="text-sm text-gray-400">Passed</div>
                </div>
                <div class="text-center">
                    <div id="failed-count" class="text-2xl font-bold test-fail">0</div>
                    <div class="text-sm text-gray-400">Failed</div>
                </div>
                <div class="text-center">
                    <div id="total-count" class="text-2xl font-bold text-gray-300">0</div>
                    <div class="text-sm text-gray-400">Total</div>
                </div>
            </div>
        </div>

        <!-- Run All Tests -->
        <div class="mt-8 text-center">
            <button onclick="runAllTests()" class="bg-gradient-to-r from-purple-500 to-cyan-500 text-white px-8 py-3 rounded-lg text-lg font-semibold hover:from-purple-600 hover:to-cyan-600">
                ğŸš€ Run All Tests
            </button>
        </div>
    </div>

    <script>
        const API_BASE = 'https://axonflow-backend.onrender.com';
        let testResults = { passed: 0, failed: 0, total: 0 };

        function addTestResult(containerId, testName, passed, details = '') {
            const container = document.getElementById(containerId);
            const testDiv = document.createElement('div');
            testDiv.className = `flex justify-between items-center p-2 rounded ${passed ? 'bg-green-900/30' : 'bg-red-900/30'}`;
            testDiv.innerHTML = `
                <span class="${passed ? 'test-pass' : 'test-fail'}">${passed ? 'âœ…' : 'âŒ'} ${testName}</span>
                ${details ? `<span class="text-xs text-gray-400">${details}</span>` : ''}
            `;
            container.appendChild(testDiv);
            
            testResults.total++;
            if (passed) testResults.passed++;
            else testResults.failed++;
            updateSummary();
        }

        function updateSummary() {
            document.getElementById('passed-count').textContent = testResults.passed;
            document.getElementById('failed-count').textContent = testResults.failed;
            document.getElementById('total-count').textContent = testResults.total;
        }

        async function runBackendTests() {
            document.getElementById('backend-tests').innerHTML = '';
            
            // Health Check
            try {
                const response = await fetch(`${API_BASE}/api/health`);
                const data = await response.json();
                addTestResult('backend-tests', 'Health Check', response.ok && data.status === 'healthy');
            } catch (error) {
                addTestResult('backend-tests', 'Health Check', false, error.message);
            }

            // AI Chat Endpoint
            try {
                const response = await fetch(`${API_BASE}/api/ai-teacher/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: 'test', course: 'general' })
                });
                const data = await response.json();
                addTestResult('backend-tests', 'AI Chat API', response.ok && data.response);
            } catch (error) {
                addTestResult('backend-tests', 'AI Chat API', false, error.message);
            }

            // Courses Endpoint
            try {
                const response = await fetch(`${API_BASE}/api/ai-teacher/courses`);
                const data = await response.json();
                addTestResult('backend-tests', 'Courses API', response.ok && data.courses && data.courses.length > 0);
            } catch (error) {
                addTestResult('backend-tests', 'Courses API', false, error.message);
            }

            // Enrollment Endpoint
            try {
                const response = await fetch(`${API_BASE}/api/enrollment`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        course_id: 'test',
                        course_name: 'Test Course',
                        user_name: 'Test User',
                        user_email: 'test@test.com',
                        phone: '1234567890',
                        price: 1000,
                        transaction_id: 'TEST123'
                    })
                });
                const data = await response.json();
                addTestResult('backend-tests', 'Enrollment API', response.ok && data.success);
            } catch (error) {
                addTestResult('backend-tests', 'Enrollment API', false, error.message);
            }

            // CORS Test
            try {
                const response = await fetch(`${API_BASE}/api/health`, {
                    method: 'GET',
                    headers: { 'Origin': 'https://axonflow-platform.onrender.com' }
                });
                addTestResult('backend-tests', 'CORS Configuration', response.ok);
            } catch (error) {
                addTestResult('backend-tests', 'CORS Configuration', false, error.message);
            }
        }

        async function runFrontendTests() {
            document.getElementById('frontend-tests').innerHTML = '';

            // Page Load Test
            addTestResult('frontend-tests', 'Page Load', document.readyState === 'complete');

            // Navigation Elements
            const nav = document.querySelector('nav');
            addTestResult('frontend-tests', 'Navigation Present', !!nav);

            // MSME Logo Test
            const msmeImg = document.querySelector('img[alt*="MSME"]');
            addTestResult('frontend-tests', 'MSME Logo Present', !!msmeImg);

            // Responsive Design
            const isMobile = window.innerWidth < 768;
            const hasResponsiveClasses = document.querySelector('.md\\:flex, .lg\\:grid, .sm\\:px-6');
            addTestResult('frontend-tests', 'Responsive Design', !!hasResponsiveClasses);

            // CSS Loading
            const hasStyles = getComputedStyle(document.body).backgroundColor !== 'rgba(0, 0, 0, 0)';
            addTestResult('frontend-tests', 'CSS Loaded', hasStyles);

            // JavaScript Functionality
            const hasGlobalFunctions = typeof showAuthModal === 'function';
            addTestResult('frontend-tests', 'JavaScript Functions', hasGlobalFunctions);
        }

        async function runAITests() {
            document.getElementById('ai-tests').innerHTML = '';

            // AI Teacher Class
            const aiTeacherExists = typeof MultiAgentAITeacher !== 'undefined';
            addTestResult('ai-tests', 'AI Teacher Class', aiTeacherExists);

            // AI Teacher Instance
            const aiTeacherInstance = typeof aiTeacher !== 'undefined';
            addTestResult('ai-tests', 'AI Teacher Instance', aiTeacherInstance);

            // Multi-Agent System
            if (aiTeacherInstance && aiTeacher.agents) {
                const agentCount = Object.keys(aiTeacher.agents).length;
                addTestResult('ai-tests', 'Multi-Agent System', agentCount >= 5, `${agentCount} agents`);
            } else {
                addTestResult('ai-tests', 'Multi-Agent System', false);
            }

            // AI Chat Functionality
            try {
                const response = await fetch(`${API_BASE}/api/ai-teacher/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: 'explain neural networks', course: 'ai_fundamentals' })
                });
                const data = await response.json();
                addTestResult('ai-tests', 'AI Chat Response', response.ok && data.response.length > 10);
            } catch (error) {
                addTestResult('ai-tests', 'AI Chat Response', false, error.message);
            }

            // Gemini AI Integration
            try {
                const response = await fetch(`${API_BASE}/api/ai-teacher/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: 'what is machine learning in detail', course: 'ai_fundamentals' })
                });
                const data = await response.json();
                const hasDetailedResponse = data.response && data.response.length > 50;
                addTestResult('ai-tests', 'Gemini AI Integration', hasDetailedResponse);
            } catch (error) {
                addTestResult('ai-tests', 'Gemini AI Integration', false, error.message);
            }
        }

        async function runAuthTests() {
            document.getElementById('auth-tests').innerHTML = '';

            // Auth Modal
            const authModal = document.getElementById('auth-modal');
            addTestResult('auth-tests', 'Auth Modal Present', !!authModal);

            // Google SSO Button
            const googleBtn = document.querySelector('button[onclick*="signInWithGoogle"]');
            addTestResult('auth-tests', 'Google SSO Button', !!googleBtn);

            // Microsoft SSO Button
            const microsoftBtn = document.querySelector('button[onclick*="signInWithAzure"]');
            addTestResult('auth-tests', 'Microsoft SSO Button', !!microsoftBtn);

            // Email Auth Form
            const emailForm = document.getElementById('email-auth-form');
            addTestResult('auth-tests', 'Email Auth Form', !!emailForm);

            // Firebase Config
            const hasFirebaseConfig = typeof firebaseConfig !== 'undefined';
            addTestResult('auth-tests', 'Firebase Config', hasFirebaseConfig);

            // Local Storage Auth
            const testUser = { id: 'test', name: 'Test User', email: 'test@test.com' };
            localStorage.setItem('test_auth', JSON.stringify(testUser));
            const storedUser = JSON.parse(localStorage.getItem('test_auth') || '{}');
            addTestResult('auth-tests', 'Local Storage Auth', storedUser.id === 'test');
            localStorage.removeItem('test_auth');

            // Auth State Management
            const hasAuthFunctions = typeof signInWithGoogle === 'function' && typeof signOut === 'function';
            addTestResult('auth-tests', 'Auth Functions', hasAuthFunctions);
        }

        async function runPaymentTests() {
            document.getElementById('payment-tests').innerHTML = '';

            // Payment Modal
            const paymentModal = document.getElementById('payment-modal');
            addTestResult('payment-tests', 'Payment Modal Present', !!paymentModal);

            // UPI Integration
            const upiText = document.body.textContent.includes('axonflow.in@ptyes');
            addTestResult('payment-tests', 'UPI ID Present', upiText);

            // Enrollment Function
            const hasEnrollmentFunction = typeof showEnrollmentForm === 'function';
            addTestResult('payment-tests', 'Enrollment Function', hasEnrollmentFunction);

            // Payment Processing
            const hasPaymentFunction = typeof proceedToPayment === 'function';
            addTestResult('payment-tests', 'Payment Processing', hasPaymentFunction);

            // Transaction Validation
            const hasTransactionValidation = document.body.textContent.includes('transaction');
            addTestResult('payment-tests', 'Transaction Validation', hasTransactionValidation);

            // Course Pricing
            const hasPricing = document.body.textContent.includes('â‚¹25,000') || document.body.textContent.includes('â‚¹18,000');
            addTestResult('payment-tests', 'Course Pricing Display', hasPricing);
        }

        async function runCourseTests() {
            document.getElementById('course-tests').innerHTML = '';

            // Course Catalog
            try {
                const response = await fetch(`${API_BASE}/api/ai-teacher/courses`);
                const data = await response.json();
                addTestResult('course-tests', 'Course Catalog API', response.ok && data.courses.length > 0);
            } catch (error) {
                addTestResult('course-tests', 'Course Catalog API', false, error.message);
            }

            // Course Cards
            const courseCards = document.querySelectorAll('[class*="course"], [onclick*="showEnrollmentForm"]');
            addTestResult('course-tests', 'Course Cards Present', courseCards.length > 0, `${courseCards.length} cards`);

            // Course Pricing
            const pricingElements = document.querySelectorAll('[class*="price"], .text-2xl:contains("â‚¹")');
            addTestResult('course-tests', 'Course Pricing', pricingElements.length > 0);

            // Course Categories
            const categories = ['AI Agent Development', 'Full-Stack Development', 'Testing & QA'];
            const hasCategories = categories.some(cat => document.body.textContent.includes(cat));
            addTestResult('course-tests', 'Course Categories', hasCategories);

            // Enrollment System
            const hasEnrollmentSystem = typeof showEnrollmentForm === 'function';
            addTestResult('course-tests', 'Enrollment System', hasEnrollmentSystem);

            // Course Duration Info
            const hasDurationInfo = document.body.textContent.includes('months') || document.body.textContent.includes('weeks');
            addTestResult('course-tests', 'Course Duration Info', hasDurationInfo);

            // Mentorship Info
            const hasMentorshipInfo = document.body.textContent.includes('mentorship') || document.body.textContent.includes('1:1');
            addTestResult('course-tests', 'Mentorship Information', hasMentorshipInfo);
        }

        async function runAllTests() {
            testResults = { passed: 0, failed: 0, total: 0 };
            document.querySelectorAll('[id$="-tests"]').forEach(container => {
                container.innerHTML = '<div class="text-yellow-500">ğŸ”„ Running tests...</div>';
            });

            await runBackendTests();
            await runFrontendTests();
            await runAITests();
            await runAuthTests();
            await runPaymentTests();
            await runCourseTests();

            // Final Summary
            const passRate = ((testResults.passed / testResults.total) * 100).toFixed(1);
            console.log(`Test Summary: ${testResults.passed}/${testResults.total} passed (${passRate}%)`);
            
            if (passRate >= 90) {
                alert(`ğŸ‰ Excellent! ${passRate}% tests passed. Platform is production ready!`);
            } else if (passRate >= 75) {
                alert(`âœ… Good! ${passRate}% tests passed. Minor issues to address.`);
            } else {
                alert(`âš ï¸ ${passRate}% tests passed. Several issues need attention.`);
            }
        }

        // Auto-run tests on page load
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸ§ª AxonFlow Test Suite Loaded');
        });
    </script>
</body>
</html>