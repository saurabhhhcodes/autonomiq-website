<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Course Player | AxonFlow Academy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="js/firebase-config.js"></script>
    <script src="js/user-storage.js"></script>
    <script src="js/course-manager.js"></script>
    <script src="js/global-auth.js"></script>
</head>
<body class="bg-slate-950 text-white min-h-screen">
    <nav class="bg-slate-900 border-b border-slate-800 p-4">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <a href="my-courses.html" class="text-cyan-400 hover:underline">‚Üê Back to My Courses</a>
            <h1 id="course-title" class="text-xl font-bold"></h1>
            <div id="user-info"></div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto p-6 grid grid-cols-1 lg:grid-cols-4 gap-6">
        <!-- Sidebar - Course Modules -->
        <div class="lg:col-span-1 bg-slate-900 rounded-xl p-4 h-fit">
            <h2 class="text-xl font-bold mb-4">üìö Course Content</h2>
            <div id="modules-list" class="space-y-2"></div>
            <div class="mt-6 pt-4 border-t border-slate-800">
                <div class="text-sm text-gray-400 mb-2">Progress</div>
                <div class="bg-slate-800 rounded-full h-2 mb-2">
                    <div id="progress-bar" class="bg-gradient-to-r from-purple-500 to-cyan-500 h-2 rounded-full" style="width:0%"></div>
                </div>
                <div id="progress-text" class="text-sm text-cyan-400">0% Complete</div>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="lg:col-span-3 space-y-6">
            <!-- Video/Content Player -->
            <div class="bg-slate-900 rounded-xl p-6">
                <div id="content-area" class="min-h-[400px]">
                    <div class="flex items-center justify-center h-96 bg-slate-800 rounded-lg">
                        <div class="text-center">
                            <div class="text-6xl mb-4">üéì</div>
                            <p class="text-gray-400">Select a module to start learning</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Teacher Access -->
            <div class="bg-gradient-to-r from-purple-900/30 to-cyan-900/30 border border-purple-500/30 rounded-xl p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-xl font-bold mb-2">ü§ñ Need Help?</h3>
                        <p class="text-gray-300">Ask our AI Teacher anything about this course</p>
                    </div>
                    <button onclick="if(window.productionAI) window.productionAI.startCourse(courseId)" class="bg-purple-500 text-white px-6 py-3 rounded-xl hover:bg-purple-600">
                        Open AI Teacher
                    </button>
                </div>
            </div>

            <!-- Assignment Submission -->
            <div class="bg-slate-900 rounded-xl p-6">
                <h3 class="text-xl font-bold mb-4">üìã Submit Assignment</h3>
                <form id="assignment-form" class="space-y-4">
                    <input type="text" id="assignment-title" placeholder="Assignment Title" class="w-full bg-slate-800 text-white rounded-lg px-4 py-3 border border-slate-700">
                    <textarea id="assignment-description" placeholder="Describe your work..." rows="4" class="w-full bg-slate-800 text-white rounded-lg px-4 py-3 border border-slate-700"></textarea>
                    <input type="url" id="assignment-link" placeholder="Project Link (GitHub, Live Demo, etc.)" class="w-full bg-slate-800 text-white rounded-lg px-4 py-3 border border-slate-700">
                    <button type="submit" class="bg-green-500 text-white px-6 py-3 rounded-xl hover:bg-green-600">Submit Assignment</button>
                </form>
            </div>
        </div>
    </div>

    <script src="js/production-course-modules.js"></script>
    <script src="js/production-ai-teacher.js"></script>
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const courseId = urlParams.get('id');
        const course = window.courseManager.getCourse(courseId);

        if (!course) {
            window.location.href = 'my-courses.html';
        }

        document.getElementById('course-title').textContent = course.name;
        document.getElementById('progress-bar').style.width = course.progress + '%';
        document.getElementById('progress-text').textContent = course.progress + '% Complete';

        // Render modules
        const modulesList = document.getElementById('modules-list');
        course.modules.forEach(module => {
            const isCompleted = course.completedModules.includes(module.id);
            const div = document.createElement('div');
            div.className = `p-3 rounded-lg cursor-pointer transition-all ${isCompleted ? 'bg-green-900/30 border border-green-500/30' : 'bg-slate-800 hover:bg-slate-700'}`;
            div.innerHTML = `
                <div class="flex items-center justify-between">
                    <div class="flex-1">
                        <div class="font-medium text-sm">${module.title}</div>
                        <div class="text-xs text-gray-400">${module.duration}</div>
                    </div>
                    ${isCompleted ? '<span class="text-green-400">‚úì</span>' : ''}
                </div>
            `;
            div.onclick = () => loadModule(module);
            modulesList.appendChild(div);
        });

        function loadModule(module) {
            const contentArea = document.getElementById('content-area');
            contentArea.innerHTML = `
                <div class="space-y-4">
                    <h2 class="text-2xl font-bold">${module.title}</h2>
                    <div class="bg-slate-800 rounded-lg p-8 text-center">
                        <div class="text-6xl mb-4">${module.type === 'video' ? 'üé•' : 'üíª'}</div>
                        <p class="text-gray-300 mb-4">${module.type === 'video' ? 'Video content would play here' : 'Project instructions and resources'}</p>
                        <p class="text-sm text-gray-400 mb-6">Duration: ${module.duration}</p>
                        <button onclick="completeModule(${module.id})" class="bg-cyan-500 text-white px-8 py-3 rounded-xl hover:bg-cyan-600">
                            Mark as Complete
                        </button>
                    </div>
                    <div class="bg-purple-500/20 border border-purple-500/30 rounded-lg p-4">
                        <p class="text-sm text-purple-200">üí° Tip: Use the AI Teacher below if you have questions about this module!</p>
                    </div>
                </div>
            `;
        }

        function completeModule(moduleId) {
            window.courseManager.updateProgress(courseId, moduleId);
            location.reload();
        }

        // Assignment submission
        document.getElementById('assignment-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const data = {
                title: document.getElementById('assignment-title').value,
                description: document.getElementById('assignment-description').value,
                link: document.getElementById('assignment-link').value
            };
            window.courseManager.submitAssignment(courseId, data);
            alert('‚úÖ Assignment submitted successfully!');
            e.target.reset();
        });
    </script>
</body>
</html>
